<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kb.star.util.UserDao">
	<!-- 쿼리문 -->
	<!-- 부서id조회 -->
	<select id="departmentAdmin" resultType="int">
		select DepartmentID from
		Users where
		UserID=#{param1}
	</select>
	<!-- 부서의 전체 유저리스트 -->
	<select id="userListAdmin"
		resultType="com.kb.star.dto.UserListDto">
		SELECT
		u.UserID,
		u.UserName,
		u.Email,
		u.birth,
		u.Password,
		d.DepartmentName,
		t.TeamName,
		u.ProfileImg,
		u.IsDelete,
		u.IsAdmin
		FROM
		Users u
		LEFT JOIN
		Departments d ON u.DepartmentID = d.DepartmentID
		LEFT
		JOIN
		Teams t ON u.TeamID = t.TeamID
		WHERE
		u.DepartmentID =
		#{departmentId}
	</select>
	<!--유저 마이페이지 리스트 -->
	<select id="userListUser"
		resultType="com.kb.star.dto.UserListDto">
		SELECT
		u.UserID,
		u.UserName,
		u.Email,
		u.birth,
		u.Password,
		d.DepartmentName,
		t.TeamName,
		u.ProfileImg,
		u.IsDelete,
		u.IsAdmin
		FROM
		Users u
		LEFT JOIN
		Departments d ON u.DepartmentID = d.DepartmentID
		LEFT
		JOIN
		Teams t ON u.TeamID = t.TeamID
		WHERE
		u.UserID =
		#{UserID}
	</select>
	<select id="getdepartmentName" resultType="String">
		select DepartmentName
		from Departments where DepartmentID = #{param1};
	</select>
	<select id="getTeamName" resultType="com.kb.star.dto.Teams">
		select * from Teams where
		DepartmentID = #{param1};
	</select>
	<insert id="insertUser" parameterType="com.kb.star.dto.UsersDto">
		INSERT INTO Users (UserID,
		UserName, Email, birth, Password, DepartmentID,
		TeamID, ProfileImg,
		IsDelete, IsAdmin)
		VALUES (#{param1}, #{param2}, #{param3}, #{param4},
		#{param5},
		#{param6}, #{param7}, null, false, false)
	</insert>

	<select id="userDepartment" resultType="String">
		select DepartmentID from Users where UserId=#{param1}
	</select>



	<select id="userList" resultType="com.kb.star.dto.UsersDto">
		select * from Users where
		DepartmentID=#{param1} and UserId!=#{param2}
	</select>

	<insert id="insertNewRoom">
		INSERT INTO MeetingRooms
		(RoomTitle,Description,DepartmentID,TeamID,RoomManagerID,StageID,EndDate)
		values (#{param1},#{param2},#{param3},#{param4},#{param5},1,#{param6})
	</insert>

	<select id="roomNumConfirm" resultType="int">
		select max(RoomID) from
		MeetingRooms where RoomManagerID=#{param1}
	</select>

	<insert id="insertNewTimer">
		INSERT INTO Timer values
		(#{param1},0,now(),#{param2})
	</insert>

	<insert id="insertUserIntoRoom">
		INSERT INTO MeetingRoomMembers values (#{param1},
		#{param2}, "noPick", 0, 0)
	</insert>

	<insert id="insertThisStage0">
		INSERT into StageParticipation
		(IdeaID,StageID,UserID,Status,RoomID) values
		(0,0,#{param1},1,#{param2})
	</insert>


	<select id="myMeetingRoom"
		resultType="com.kb.star.dto.MeetingRooms">
		SELECT mr.* from MeetingRooms mr inner join MeetingRoomMembers mrm on
		mr.RoomID = mrm.RoomID
		where mr.IsDelete = 0 and mrm.UserID = #{param1} and mr.EndDate >=
		curdate() order by mr.RoomID desc limit 3;
	</select>

	<insert id="insertForwardStage1">
		INSERT into StageParticipation
		(IdeaID,StageID,UserID,Status,RoomID) values
		(0,1,#{param1},0,#{param2})
	</insert>
	<!-- 프로필사진 업데이트 -->
	<update id="updateProfileImg" parameterType="map">
		UPDATE Users
		SET
		ProfileImg = #{profileImg}
		WHERE UserID = #{userId}
	</update>
	
	<!-- 회의방목록볼때 회의방별 팀명 조회하기위한 쿼리문 -->
	<select id="myDepartmentTeams" resultType="com.kb.star.dto.Teams">
		select * from Teams WHERE DepartmentID=#{param1}
	</select>
	
	<select id="myAllMeetingRoom" resultType="com.kb.star.dto.MeetingRooms">
		SELECT mr.* from MeetingRooms mr inner join MeetingRoomMembers mrm on mr.RoomID = mrm.RoomID
		where mr.IsDelete = 0 and mrm.UserID = #{param1} order by mr.RoomID desc;
	</select>

</mapper>
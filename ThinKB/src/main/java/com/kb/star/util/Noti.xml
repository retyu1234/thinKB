<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="com.kb.star.util.NotiDao">

	<!-- 알림 목록(모든정보) 가져오기 -->
	<select id="getAllNoti" resultType="com.kb.star.dto.NotiDto">
		SELECT * FROM Notifications WHERE UserID = #{userId} AND IsDelete = FALSE ORDER BY CreatedAt DESC
	</select>
	
	<!-- IdeaID로 아이디어 정보  가져오기 -->
    <select id="getIdeaById" resultType="com.kb.star.dto.Ideas">
        SELECT IdeaID, RoomID, Title FROM Ideas WHERE IdeaID = #{ideaId}
    </select>
     
     <!-- Ideas 테이블의 RoomID컬럼으로 MeetingRooms 테이블 정보 가져오기(roomTitle) -->
     <select id="getRoomTitleById" resultType="com.kb.star.dto.MeetingRooms">
        SELECT RoomTitle FROM MeetingRooms WHERE RoomID = #{RoomID}
    </select>
	
	<!-- 알림 읽음 상태 업데이트 -->
    <update id="updateReadStatus">
        UPDATE Notifications SET IsRead = true WHERE NotificationID = #{notificationID}
    </update>
    
    <!-- 알림 삭제 -->
    <update id="deleteNotification">
        UPDATE Notifications SET IsDelete = true WHERE NotificationID = #{notificationID}
    </update>
    <!-- 실시간 알림 생성시간에 따라 -->
    <select id="findNewNotifications" resultType="com.kb.star.dto.NotiDto">
        SELECT * FROM Notifications
        WHERE UserID = #{param1}
        AND CreatedAt > #{param2}
        AND IsDelete = 0
        ORDER BY CreatedAt DESC
    </select>
    
    <!-- 알림 모두 읽기 -->
    <update id="allReadNotification" parameterType="int">
		UPDATE Notifications SET IsRead=1 WHERE UserID=#{param1} AND IsRead=0 
    </update>

</mapper>